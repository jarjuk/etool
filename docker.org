* ~etool~ Docker
  :PROPERTIES:
  :header-args+: :dir  docker/etool
  :header-args+: :var  ETOOL_DOCKER_TAG="2"
  :END:


** Build  ~marcus2002/etool~ 


#+BEGIN_SRC bash :eval no-export :results output :exports output
echo Current ETOOL_DOCKER_TAG=$ETOOL_DOCKER_TAG
#+END_SRC

#+RESULTS:
: Current ETOOL_DOCKER_TAG=2

Build ~marcus2002/etool:$ETOOL_DOCKER_TAG~

#+BEGIN_SRC bash :eval no-export :results output :exports code
echo $ETOOL_DOCKER_TAG > VERSION
docker build -t marcus2002/etool:$ETOOL_DOCKER_TAG .  2>&1; echo $?
#+END_SRC

#+RESULTS:
#+begin_example
Sending build context to Docker daemon  265.2kB
Step 1/26 : FROM ubuntu:18.04
 ---> c3c304cb4f22
Step 2/26 : RUN apt-get update &&      apt-get install -y      curl      wget      git      gnupg2  gnupg
 ---> Using cache
 ---> 8649238509b5
Step 3/26 : RUN apt-get install -y       build-essential       linux-headers-$(uname -r)       dkms
 ---> Using cache
 ---> ace38c0968f1
Step 4/26 : ENV LANG C.UTF-8
 ---> Using cache
 ---> 2157eb1ec776
Step 5/26 : ENV TZ=Europe/Helsinki
 ---> Using cache
 ---> 4adfde947877
Step 6/26 : RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
 ---> Using cache
 ---> b8d4f93898a9
Step 7/26 : RUN apt-get -y install     tzdata
 ---> Using cache
 ---> e4bab8080cb0
Step 8/26 : RUN     sudo cp /etc/apt/sources.list /etc/apt/sources.list.orig     &&   sed -i -e'/bionic main restricted/s!# deb-src!deb-src!'                       -e'/bionic-updates main restricted/s!# deb-src!deb-src!'                 -e'/bionic universe/s!# deb-src!deb-src!'                 -e'/bionic-updates universe/s!# deb-src!deb-src!'                 /etc/apt/sources.list     && apt-get update
 ---> Using cache
 ---> 1844c3037dee
Step 9/26 : RUN apt-get -y install    devscripts    build-essential     dpkg-dev    debhelper    dh-python    libudev-dev    libxenomai-dev    tcl8.6-dev    tk8.6-dev    libreadline-gplv2-dev    asciidoc dblatex    docbook-xsl    dvipng    graphviz    groff    inkscape    python-lxml    source-highlight    w3c-linkchecker    xsltproc    texlive-extra-utils    texlive-font-utils    texlive-fonts-recommended texlive-lang-cyrillic texlive-lang-french texlive-lang-german texlive-lang-polish texlive-lang-spanish    texlive-latex-recommended asciidoc-dblatex python python-dev python-tk libxmu-dev    libglu1-mesa-dev libgl1-mesa-dev    libgtk2.0-dev intltool autoconf libboost-python-dev    libmodbus-dev    libusb-1.0-0-dev yapps2    iptables netcat psmisc desktop-file-utils
 ---> Using cache
 ---> e75fda009662
Step 10/26 : RUN     git clone https://github.com/LinuxCNC/linuxcnc.git emc     && cd emc     && git checkout 2.8
 ---> Using cache
 ---> 73a68ce19bde
Step 11/26 : RUN diff /etc/apt/sources.list /etc/apt/sources.list.orig 2>&1; echo $?
 ---> Using cache
 ---> d977e6ea641c
Step 12/26 : RUN apt-get install -y              bwidget              libtk-img              tclx              python-gtk2
 ---> Using cache
 ---> fcd8a06b9f86
Step 13/26 : RUN    cd emc    && debian/configure uspace    && dpkg-checkbuilddeps    && cd src    && ./autogen.sh    && ./configure --with-realtime=uspace    && make
 ---> Using cache
 ---> 200f8a47440b
Step 14/26 : RUN      git clone  https://github.com/pcb2gcode/pcb2gcode      && cd pcb2gcode      && git checkout e53eae9b8d490f76be6d1716dcf3b6c0ff5aad92
 ---> Using cache
 ---> a921b980e976
Step 15/26 : RUn apt-get install -y              build-essential              automake              autoconf              autoconf-archive              libtool              libboost-program-options-dev              libgtkmm-2.4-dev              gerbv              librsvg2-dev
 ---> Using cache
 ---> 5cdec2ff9238
Step 16/26 : RUN         cd /pcb2gcode      && autoreconf -fvi      && ./configure      &&  make      && make install
 ---> Using cache
 ---> 4737d44b2d4e
Step 17/26 : RUN mkdir /pcbGcodeZprobing
 ---> Using cache
 ---> 1d81de8793de
Step 18/26 : COPY pcbGcodeZprobing.py /pcbGcodeZprobing
 ---> Using cache
 ---> efef92ab7df0
Step 19/26 : COPY resources/ /resources
 ---> Using cache
 ---> b5bd8f8934e5
Step 20/26 : WORKDIR /etool
 ---> Using cache
 ---> 23ad8584c5ef
Step 21/26 : ENV HOME=/etool
 ---> Using cache
 ---> 6312c856fd6b
Step 22/26 : RUN mkdir /etool-bin
 ---> Using cache
 ---> b344ad0c3404
Step 23/26 : ENV PATH=/etool-bin:/emc/scripts:${PATH}
 ---> Using cache
 ---> 34996b797330
Step 24/26 : COPY       etool.sh       RELEASES       VERSION       axis_etool.ini       sim_mm.tbl       .linuxcncrc       pcb2gcode.ini       pcb2gcode-control.template       Dockerfile       /etool-bin/
 ---> 2a4ddd942b4b
Step 25/26 : ENTRYPOINT [ "etool.sh" ]
 ---> Running in 800a1203c8bd
Removing intermediate container 800a1203c8bd
 ---> dae8b3d35e93
Step 26/26 : CMD [ "usage"]
 ---> Running in 9665e2f13ba2
Removing intermediate container 9665e2f13ba2
 ---> fd52f46cd292
Successfully built fd52f46cd292
Successfully tagged marcus2002/etool:2
0
#+end_example



** Push to docker repo

 *Warning makes it public*
#+BEGIN_SRC bash :eval no-export :results output
docker push marcus2002/etool:$ETOOL_DOCKER_TAG
#+END_SRC

#+RESULTS:
#+begin_example
The push refers to repository [docker.io/marcus2002/etool]
d8218be1ce51: Preparing
ddda597590aa: Preparing
ddda597590aa: Preparing
ab5a4292cfc0: Preparing
42ff10b67cf2: Preparing
122a559406da: Preparing
5bdd88eb5c1e: Preparing
af8d84ee61a1: Preparing
f1082a93cc07: Preparing
e1f7cf6e82c9: Preparing
12644fdcb7c7: Preparing
913f5aee6fb9: Preparing
1d621ba72a94: Preparing
4fa2fddd8c11: Preparing
1afcc6b88e74: Preparing
d277f19c5cf3: Preparing
b5cbc5447c49: Preparing
0ccbdce5bfb8: Preparing
f6775943028b: Preparing
bdece7ab0b8d: Preparing
f917492a171c: Preparing
56fcf7e0a24b: Preparing
c2d80069578c: Preparing
d47b9f8f5b5e: Preparing
650e4da91065: Preparing
af8d84ee61a1: Waiting
f1082a93cc07: Waiting
e1f7cf6e82c9: Waiting
5bdd88eb5c1e: Waiting
12644fdcb7c7: Waiting
913f5aee6fb9: Waiting
1afcc6b88e74: Waiting
1433bbf12295: Preparing
d277f19c5cf3: Waiting
28ba7458d04b: Preparing
838a37a24627: Preparing
b5cbc5447c49: Waiting
0ccbdce5bfb8: Waiting
f6775943028b: Waiting
bdece7ab0b8d: Waiting
a6ebef4a95c3: Preparing
b7f7d2967507: Preparing
56fcf7e0a24b: Waiting
1d621ba72a94: Waiting
c2d80069578c: Waiting
4fa2fddd8c11: Waiting
d47b9f8f5b5e: Waiting
f917492a171c: Waiting
838a37a24627: Waiting
650e4da91065: Waiting
a6ebef4a95c3: Waiting
1433bbf12295: Waiting
b7f7d2967507: Waiting
28ba7458d04b: Waiting
ab5a4292cfc0: Pushed
122a559406da: Pushed
ddda597590aa: Pushed
d8218be1ce51: Pushed
42ff10b67cf2: Pushed
af8d84ee61a1: Pushed
f1082a93cc07: Pushed
12644fdcb7c7: Pushed
e1f7cf6e82c9: Pushed
5bdd88eb5c1e: Pushed
1d621ba72a94: Pushed
913f5aee6fb9: Pushed
4fa2fddd8c11: Pushed
d277f19c5cf3: Pushed
f6775943028b: Pushed
1afcc6b88e74: Pushed
0ccbdce5bfb8: Pushed
c2d80069578c: Pushed
d47b9f8f5b5e: Pushed
56fcf7e0a24b: Pushed
b5cbc5447c49: Pushed
28ba7458d04b: Mounted from marcus2002/linuxcnc
838a37a24627: Mounted from marcus2002/linuxcnc
a6ebef4a95c3: Mounted from marcus2002/linuxcnc
b7f7d2967507: Mounted from marcus2002/linuxcnc
1433bbf12295: Pushed
650e4da91065: Pushed
bdece7ab0b8d: Pushed
f917492a171c: Pushed
1: digest: sha256:67c4ce25b60ac6e15799b827619bf0697da138132d207720cfdd19ff46c602b5 size: 6595
#+end_example


#+BEGIN_SRC bash :eval no-export :results output
docker search marcus2002
#+END_SRC

#+RESULTS:
: NAME                             DESCRIPTION   STARS     OFFICIAL   AUTOMATED
: marcus2002/tf-gpu-checker                      0                    
: marcus2002/hello                               0                    
: marcus2002/yolov3tf2                           0                    
: marcus2002/yolov3-tf2-training                 0                    
: marcus2002/tensorflow-lite-api                 0                    
: marcus2002/flatcam                             0                    
: marcus2002/linuxcnc                            0                    







* Fin                                                              :noexport:

** Emacs variables

   #+RESULTS:

   # Local Variables:
   # org-confirm-babel-evaluate: nil
   # End:
   #
   # Muuta 
   # org-cdlatex-mode: t
   # eval: (cdlatex-mode)
   #
   # Local ebib:
   # org-ref-default-bibliography: "./pcb-milling.bib"
   # org-ref-bibliography-notes: "./pcb-milling-notes.org"
   # org-ref-pdf-directory: "./pdf/"
   # org-ref-notes-directory: "."
   # bibtex-completion-notes-path: "./pcb-milling-notes.org"
   # ebib-preload-bib-files: ("./pcb-milling.bib")
   # ebib-notes-file: ("./pcb-milling-notes.org")
   # reftex-default-bibliography: ("./pcb-milling.bib")



